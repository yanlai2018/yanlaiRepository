<!DOCTYPE html>
<html lang="zh_CN" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <style>
        .col-center-block {
            float: none;
            display: block;
            margin-left: auto;
            margin-right: auto;
            margin-top: auto;
        }

        /*左侧菜单条目鼠标滑过之后变大*/
        .menu-a {
            font-size: 16px;
        }

        .menu-a:hover {
            font-size: 18px;
        }
    </style>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../rewardpoints/static/images/favicon.jpg"></link>
    <title>学习平台-用户积分管理系统</title>
    <!--公共js，包括获得项目根路径等等-->
    <script type="text/javascript" src="../../rewardpoints/static/common.js"></script>
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="../../rewardpoints/static/css/bootstrap.min.css"></link>
    <!--表单table处理-->
    <link rel="stylesheet" href="../../rewardpoints/static/bootstrap3-editable/css/bootstrap-editable.css"></link>
    <link rel="stylesheet" href="../../rewardpoints/static/login/bootstrap-table.css"/>
    <link rel="stylesheet" href="../../rewardpoints/static/login/editable-element.css"/>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link type="text/css" href="../../rewardpoints/static/docs/assets/css/ie10-viewport-bug-workaround.css"
          rel="stylesheet">
    <link rel="stylesheet" href="../../rewardpoints/static/css/style.css">
    <!-- Custom styles for this template -->
    <link href="../../rewardpoints/static/docs/examples/dashboard/dashboard.css" rel="stylesheet">
    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]>
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/javascript" src="../../rewardpoints/static/login/index.js"></script>
    <script type="text/javascript" src="../../rewardpoints/static/login/message.js"></script>
    <script type="text/javascript" src="../../rewardpoints/static/login/aes.js"></script>
    <script type="text/javascript" src="../../rewardpoints/static/login/pad-nopadding-min.js"></script>
    <script type="text/javascript" src="../../rewardpoints/static/login/mode-ecb-min.js"></script>
    <script type="text/javascript" src="../../rewardpoints/static/js/jquery.min.js"></script>
    <script type="text/javascript" src="../../rewardpoints/static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../rewardpoints/static/login/editable-element.js"></script>
    <script type="text/javascript"
            src="../../rewardpoints/static/docs/assets/js/ie8-responsive-file-warning.js"></script>
    <!--[endif]-->
    <script type="text/javascript"
            src="../../rewardpoints/static/docs/assets/js/ie-emulation-modes-warning.js"></script>
    <script type="text/javascript"
            src="../../rewardpoints/static/extensions/addrbar/bootstrap-table-addrbar.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]-->
    <script type="text/javascript" src="../../rewardpoints/static/login/html5shiv.min.js"></script>
    <script type="text/javascript" src="../../rewardpoints/static/login/respond.min.js"></script>
    <!--时间选择器相关js和cs-->
    <!-- 时间选择器样式表 -->
    <link href="../../rewardpoints/static/css/bootstrap-datetimepicker.min.css"
          rel="stylesheet">
    <!-- 时间选择器前置脚本 -->
    <script src="../../rewardpoints/static/login/moment-with-locales.min.js"></script>
    <!-- 时间选择器核心脚本 -->
    <script src="../../rewardpoints/static/js/bootstrap-datetimepicker.min.js"></script>
    <!--[endif]-->
    <script type="text/javascript" src="../../rewardpoints/static/login/bootstrap-table.js"></script>
    <script type="text/javascript" src="../../rewardpoints/static/locale/bootstrap-table-zh-CN.js"></script>
    <script type="text/javascript"
            src="../../rewardpoints/static/login/bootstrap-editable.js"></script>
    <script type="text/javascript"
            src="../../rewardpoints/static/extensions/editable/bootstrap-table-editable.js"></script>
    <!--bootstrap中文包避免后台返回给前台数据中文乱码-->
    <script type="text/javascript"
            src="../../rewardpoints/static/locale/bootstrap-table-zh-CN.js"></script>
</head>

<body>
<nav class="navbar navbar-inverse navbar-fixed-top">
    <span id="uu" hidden="hidden">${sessionScope.user.userName}</span>
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                    aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/rewardpoints/" style="font-size: 32px;line-height: 25px;">学习平台-积分管理系统</a>
        </div>

    </div>
</nav>

<div class="container-fluid">
    <div class="row">
        <div class="col-sm-3 col-md-2 sidebar" id="menuDiv"></div>
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
            <div class="breadcrumbs" id="breadcrumbs">
                <ul class="breadcrumb">
                    <li>
                        <i class="icon-home home-icon"></i>
                        <a href="/rewardpoints/" style="font-size:30px">首页</a>
                    </li>
                </ul>
            </div>
            <div class="row placeholders">
                <div class="col-sm-12">
                    <form class="form-inline query_ipt">
                        <div class="row">
                            <div class="col-sm-10" align="left">
                                <div class="form-group ipt_item">
                                    <span class="form_til">用户号</span>
                                    <input type="text" class=" input-sm" id="id" name="id"
                                           placeholder="请输入用户号">
                                </div>
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                <div class="form-group ipt_item">
                                    <span class="form_til">创建时间</span>
                                    <span class="input-icon">
												     <input type="text" id="creat_dt_begin" name="creat_dt_begin"
                                                            class="date-picker">
												     <i class="icon-calendar blue"></i>
											        </span>
                                    —
                                    <span class="input-icon">
												     <input type="text" id="creat_dt_end" name="creat_dt_end"
                                                            class="date-picker">
												     <i class="icon-calendar blue"></i>
											        </span>
                                </div>
                            </div>
                            <div class="col-sm-2" align="left">
                                <button type="button" class="btn btn-primary" id="updConfig"
                                        onclick="queryList()">查询
                                </button>
                                <font id="updConfigFig">&nbsp;</font>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <h2 class="sub-header">积分兑换积分信息列表</h2>
            <div>
                <!-- /.积分变更日志显示位置 -->
                <table id="scoreTraining" class="table"></table>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    /*初始化时间控制输入框*/
    $("#creat_dt_begin").datetimepicker({
        minView: "month", //选择日期后，不会再跳转去选择时分秒
        language: 'zh-CN',
        format: 'yyyy-mm-dd',
        autoclose: true,//选中关闭
        todayBtn: true//今日按钮
    });
    /*初始化时间控制输入框*/
    $("#creat_dt_end").datetimepicker({
        minView: "month", //选择日期后，不会再跳转去选择时分秒
        language: 'zh-CN',
        format: 'yyyy-mm-dd',
        autoclose: true,//选中关闭
        todayBtn: true//今日按钮
    });

    function queryList() {
        $("#scoreTraining").bootstrapTable('refresh');
    }

    //初始化得到查询的参数
    function queryParams(params) {
        var userId = $("#id").val();
        if (null == userId || userId.length == 0) {
            /*如下表示用户号不作为查询条件*/
            userId = "1122-zzii122.11kkqqlloo";
        }
        var key = CryptoJS.enc.Utf8.parse(ALLENCRYPTCODE);
        // Encrypt
        //把私钥转换成16进制的字符串
        var encrypted = CryptoJS.AES.encrypt(userId, key, {
            mode: CryptoJS.mode.ECB,
            padding: CryptoJS.pad.Pkcs7
        });
        userId = encrypted.toString();
        var creat_dt_begin = $("#creat_dt_begin").val();
        var creat_dt_end = $("#creat_dt_end").val();
        if (null != creat_dt_begin && '' != creat_dt_begin) {
            if (creat_dt_begin.length != 10) {
               alertWarning('消息提醒：请输入规范的日期！');
                return;
            }
            creat_dt_begin = creat_dt_begin.substring(0, 4) + creat_dt_begin.substring(5, 7) + creat_dt_begin.substring(8, 10);
            if (!isNumber(creat_dt_begin)) {
               alertWarning('消息提醒：请输入规范的日期！');
                return;
            }
        }
        if (null != creat_dt_end && '' != creat_dt_end) {
            if (creat_dt_end.length != 10) {
               alertWarning('消息提醒：请输入规范的日期！');
                return;
            }
            creat_dt_end = creat_dt_end.substring(0, 4) + creat_dt_end.substring(5, 7) + creat_dt_end.substring(8, 10);
            if (!isNumber(creat_dt_end)) {
               alertWarning('消息提醒：请输入规范的日期！');
                return;
            }
        }
        if (null != creat_dt_end && '' != creat_dt_end && null != creat_dt_begin && '' != creat_dt_begin) {
            if (creat_dt_end < creat_dt_begin) {
                alertWarning('消息提醒：起始日期不能大于结束日期！');
                return;
            }
        }

        var temp = {   //这里的键的名字和控制器的变量名必须一直，这边改动，控制器也需要改成一样的
            // limit: params.limit,   //页面大小
            offset: params.offset,  //页码
            pageSize: this.pageSize,
            pageNumber: this.pageNumber,
            qrytype: "Z/oZ8sVGrDM=", /*查询积分兑换信息类型*/
            userid: userId,
            qrytmbegin: creat_dt_begin,
            qrytmend: creat_dt_end,
            length: 6
        };
        return temp;
    }


    //查询k积分兑换积分列表
    $('#scoreTraining').bootstrapTable({
        url: "app/queryScore",
        method: 'post',
        dataType: "json",
        queryParams: queryParams,
        classes: 'table',//边框
        undefinedText: '',//当数据为 undefined 时显示的字符
        pagination: true,//启动分页
        paginationLoop: true,
        pageNumber: 1,
        pageSize: 10,
        pageList: [1, 5, 10, 20],
        striped: true,
        showColumns: true,  //显示下拉框勾选要显示的列
        sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
        showRefresh: true,  //显示刷新按钮
        showToggle: true,//显示一行是否改成竖着
        showPaginationSwitch: true,//是否显示 下面的分页框
        height: 500,                        //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
        search: false, //显示搜索框
        detailView: true,
        toolbal: '#toolbar',
        detailFormatter: function (index, row) {
            return JSON.stringify(row);
        },
        columns: [{
            field: 'checkbox',
            title: 'checkbox',
            checkbox: true
        }, {
            field: 'number',
            title: '序号',
            formatter: function (value, row, index) {
                return index + 1;
            }
        }, {
            field: 'id',
            title: '积分兑换id',
            align: 'center',
            hidden: true
        }, {
            field: 'userid',
            title: '用户id',
            align: 'center'
        }, {
            field: 'score',
            title: '兑后分数',
            align: 'center'
        }, {
            field: 'exchange_score',
            title: '兑换金额',
            align: 'center'
        }, {
            title: '更新时间',
            field: 'update_tm',
            align: 'center'
        }, {
            title: '创建时间',
            field: 'creation_tm',
            align: 'center'
        }, {
            field: '',
            title: '', /*操作*/
            align: 'center',
            formatter: function (value, row, index) {
                var d = '';
                // <a  style="display: block;margin-top:5px;" class="btn btn-info btn-xs" onclick="view(\'' + index + '\')">' +
                //     '<i class="glyphicon glyphicon-list-alt"></i>查看</a>
                return d;
            }
        }],
        onLoadSuccess: function (data) {
            if (data.code == "1005") {
                alertWarning('提示信息：数据为空！');
                $('#scoreTraining').bootstrapTable('load', {total: 0, rows: []});
                // $('#scoreTraining').bootstrapTable('destroy');
            } else if (data.code != "1000") {
                alertWarning('提示信息：查询失败！');
                $('#scoreTraining').bootstrapTable('load', {total: 0, rows: []});
            }
        },
        onLoadError: function () {
            alertWarning('提示信息：数据加载失败！');
        },
        onDblClickRow: function (contentlist, $element) {
            /*这里是点击每行数据触发事件*/
            // var id = contentlist.id;
            // var total = contentlist.total;
            // EditViewById(id, 'view');
        }
    });
</script>
<script type="text/javascript">
    $.get("menu.html", function (mdata) {
        $("#menuDiv").html(mdata);
    })
</script>
</body>
</html>




